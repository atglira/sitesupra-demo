{% set width_full = 960 %}
{% set height_full = 600 %}
{% set width_small = 420 %}

{# <!-- Macro for outputing images --> #}
	{% macro imageHtmlTag (image, width, height) %}
		
		{% if not width %}{% set width = image.crop_width %}{% endif %}
		{% if not height %}{% set height = image.crop_height %}{% endif %}
		
		{# {{ supraBlock.preloadImage( image.imageId, width, height, true, image.size_name ) }} #}
		
		{% set tag = supraBlock.imageHtmlTag( image.imageId, width, height, true, image.size_name )|raw %}
		{% set width = tag.getAttribute('width') %}
		{% set height = tag.getAttribute('height') %}

		{% if width or height %}
			{% set ratio = width / height %}

			{% if width < 420 %}
				{# <!-- Larger image for table and mobile --> #}
				{% set width_mobile = 420 %}
			{% set tag_mobile = supraBlock.imageHtmlTag( image.imageId, width_mobile, width_mobile / ratio, true )|raw %}
			{% endif %}

			<img src="{{ tag.getAttribute('src') }}" width="{{ width }}" height="{{ height }}" {% if width < 420 %}
				 data-src-desktop="{{ tag.getAttribute('src') }}" data-height-desktop="{{ height }}"
				 data-src-mobile-all="{{ tag_mobile.getAttribute('src') }}" data-height-mobile-all="{{ tag_mobile.getAttribute('tag_mobile') }}"
				 class="responsive"
				 {% endif %}alt="" />
		{% endif %}
		
	{% endmacro %}
	{% import _self as output %}


{% set style = supraBlock.property('style') %}
{% set design = supraBlock.property('design') %}
{% set images = supraBlock.property('images') %}
{% set heading_class = 'no-heading' %}

{% if images|length or supra.cmsRequest %}

	<div class="block gallery" data-refresh-event="gallery">
	
		{% if not supraBlock.isEmpty('block_title') %}
		<h2 class="block-title"><div>
			{{ supraBlock.property('block_title') }}
			{% set heading_class = 'has-heading' %}
		</div></h2>
		{% endif %}
	
	{% if style == "slideshow" %}
		
		<div class="promo-slider design-{{ design }} {{ heading_class }}" data-refresh-event="promo" data-style="thumbs-outer" data-animation="horizontal">
			<ul>
				{% for image in images %}
				<li>
					
					{{ output.imageHtmlTag(image, width_full, height_full) }}
					
					<div>
						{% set property = image.property %}

						{% if property.title %}<h2>{{ property.title }}</h2>{% endif %}
						{% if property.description %}<p>{{ property.description }}</p>{% endif %}
					</div>
				</li>
				{% endfor %}
			</ul>
			<div class="shadow"></div>
		</div>
		
		{# Instructions how to render item in CMS Gallery manager edit mode #}
		{% if supra.cmsRequest %}{% raw %}
		<script type="text/supra-template" data-supra-container-selector="ul" data-supra-id="gallerymanager-item">
			<li>
				{% endraw %}<img src="about:blank" alt="" width="{{ width_full }}" height="{{ height_full }}" />{% raw %}
				<div>
					<h2>{{ property.title }}</h2>
					<p>{{ property.description }}</p>
				</div>
			</li>
		</script>
		{% endraw %}{% endif %}
	
	{% elseif style == "grid" %}
	
		<div class="products-slider style-{{ design }}" data-refresh-event="carousel" data-style="{{ design }}">
			<div class="products-slider-inner clearfix">
			<ul class="clearfix">
				{% for index, product in images %}
					{% if index and index % 4 == 0 %}
						<li class="clear"></li>
					{% endif %}
					
					<li class="grid_4 {% if not index %}alpha{% endif %}">
						
						{# {{ supraBlock.preloadImage( product.imageId, width_full, height_full, true ) }} #}
						{% set tag_full = supraBlock.imageHtmlTag( product.imageId, width_full, height_full, true ) | raw %}
						
						{% if design == "box" %}
							
							<span class="outer">
								
								<span class="inner-text">
									<h2>{{ product.property.title }}</h2>
									<p>{{ product.property.description }}</p>
								</span>
								
								<a class="img" rel="lightbox"
									href="{{ tag_full.getAttribute('src') }}"
							    	title="{{ product.property.title }}">
									
									{{ output.imageHtmlTag(product) }}
								</a>
								
							</span>
							
						{% else %}
							
							<a class="img" rel="lightbox"
								href="{{ tag_full.getAttribute('src') }}"
							    title="{{ product.property.title }}">
							    
								{{ output.imageHtmlTag(product) }}
							</a>
						
							<h2>{{ product.property.title }}</h2>
							<p>{{ product.property.description }}</p>
							
						{% endif %}
					</li>
				{% endfor %}
				
				<li class="clear"></li>
			</ul>
			</div>
		</div>
		
		{# Instructions how to render item in CMS Gallery manager edit mode #}
		{% if supra.cmsRequest %}{% raw %}
		<script type="text/supra-template" data-supra-container-selector="ul" data-supra-id="gallerymanager-item">
			<li class="grid_4">
				{% if design == "box" %}
					
					<span class="outer">
						<span class="inner-text">
							<h2>{{ property.title }}</h2>
							<p>{{ property.description }}</p>
						</span>
						<img src="about:blank" alt="" width="220" height="125" />
					</span>
				
				{% else %}
				
					<img src="about:blank" alt="" width="220" height="125" />
					<h2>{{ property.title }}</h2>
					<p>{{ property.description }}</p>
				
				{% endif %}
			</li>
		</script>
		{% endraw %}{% endif %}

	{% endif %}
	</div>
	
{% endif %}