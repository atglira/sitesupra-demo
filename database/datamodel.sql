CREATE TABLE block (id INT AUTO_INCREMENT NOT NULL, place_holder_id INT NOT NULL, component VARCHAR(255) NOT NULL, position INT NOT NULL, locked TINYINT(1) DEFAULT NULL, discr VARCHAR(255) NOT NULL, PRIMARY KEY(id)) ENGINE = InnoDB;
CREATE TABLE block_property (id INT AUTO_INCREMENT NOT NULL, data_id INT NOT NULL, block_id INT NOT NULL, name VARCHAR(255) NOT NULL, value VARCHAR(255) DEFAULT NULL, PRIMARY KEY(id)) ENGINE = InnoDB;
CREATE TABLE data (id INT AUTO_INCREMENT NOT NULL, locale VARCHAR(255) NOT NULL, title VARCHAR(255) NOT NULL, discr VARCHAR(255) NOT NULL, PRIMARY KEY(id)) ENGINE = InnoDB;
CREATE TABLE page_abstraction (id INT AUTO_INCREMENT NOT NULL, depth INT NOT NULL, discr VARCHAR(255) NOT NULL, PRIMARY KEY(id)) ENGINE = InnoDB;
CREATE TABLE place_holder (id INT AUTO_INCREMENT NOT NULL, master_id INT NOT NULL, type INT NOT NULL, name VARCHAR(255) NOT NULL, discr VARCHAR(255) NOT NULL, locked TINYINT(1) DEFAULT NULL, PRIMARY KEY(id)) ENGINE = InnoDB;
CREATE TABLE layout (id INT AUTO_INCREMENT NOT NULL, file VARCHAR(255) NOT NULL, PRIMARY KEY(id)) ENGINE = InnoDB;
CREATE TABLE layout_place_holder (id INT AUTO_INCREMENT NOT NULL, layout_id INT NOT NULL, name VARCHAR(255) NOT NULL, PRIMARY KEY(id)) ENGINE = InnoDB;
CREATE TABLE page (id INT NOT NULL, template_id INT NOT NULL, parent_id INT DEFAULT NULL, PRIMARY KEY(id)) ENGINE = InnoDB;
CREATE TABLE page_data (id INT NOT NULL, page_id INT NOT NULL, path VARCHAR(255) NOT NULL, path_part VARCHAR(255) NOT NULL, UNIQUE INDEX page_data_path_uniq (path), PRIMARY KEY(id)) ENGINE = InnoDB;
CREATE TABLE template (id INT NOT NULL, parent_id INT DEFAULT NULL, PRIMARY KEY(id)) ENGINE = InnoDB;
CREATE TABLE template_data (id INT NOT NULL, template_id INT NOT NULL, PRIMARY KEY(id)) ENGINE = InnoDB;
CREATE TABLE template_layout (id INT AUTO_INCREMENT NOT NULL, layout_id INT NOT NULL, template_id INT NOT NULL, media VARCHAR(255) NOT NULL, PRIMARY KEY(id)) ENGINE = InnoDB;
ALTER TABLE block ADD FOREIGN KEY (place_holder_id) REFERENCES place_holder(id);
ALTER TABLE block_property ADD FOREIGN KEY (data_id) REFERENCES data(id);
ALTER TABLE block_property ADD FOREIGN KEY (block_id) REFERENCES block(id);
ALTER TABLE place_holder ADD FOREIGN KEY (master_id) REFERENCES page_abstraction(id);
ALTER TABLE layout_place_holder ADD FOREIGN KEY (layout_id) REFERENCES layout(id);
ALTER TABLE page ADD FOREIGN KEY (template_id) REFERENCES template(id);
ALTER TABLE page ADD FOREIGN KEY (parent_id) REFERENCES page(id);
ALTER TABLE page ADD FOREIGN KEY (id) REFERENCES page_abstraction(id) ON DELETE CASCADE;
ALTER TABLE page_data ADD FOREIGN KEY (page_id) REFERENCES page(id);
ALTER TABLE page_data ADD FOREIGN KEY (id) REFERENCES data(id) ON DELETE CASCADE;
ALTER TABLE template ADD FOREIGN KEY (parent_id) REFERENCES template(id);
ALTER TABLE template ADD FOREIGN KEY (id) REFERENCES page_abstraction(id) ON DELETE CASCADE;
ALTER TABLE template_data ADD FOREIGN KEY (template_id) REFERENCES template(id);
ALTER TABLE template_data ADD FOREIGN KEY (id) REFERENCES data(id) ON DELETE CASCADE;
ALTER TABLE template_layout ADD FOREIGN KEY (layout_id) REFERENCES layout(id);
ALTER TABLE template_layout ADD FOREIGN KEY (template_id) REFERENCES template(id);
