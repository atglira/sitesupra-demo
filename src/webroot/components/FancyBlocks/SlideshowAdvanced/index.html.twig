{% import _self as slideshow %}

<div class="block">
	<div class="slideshow-advanced" data-attach="$.fn.slideshowAdvanced" {% if supraBlock.property('scrollTimerEnabled') %}data-scroll-timer="5"{% endif %}>
		<ul class="as-container" data-supra-container="true">
			{% if slides %}
				{# Slide data here #}
				{% for slide in slides %}
					{% set media = slideshow.media(slide['media']) %}
					{% set background = slideshow.background(slide['background']) %}
					{% set text_main = slide['text_main'] %}
					{% set text_top = slide['text_top'] %}
				
					{% set property = {
						'media': media, 
						'text_main': text_main,
						'text_top': text_top,
						'background': background
					} %}
				
					{# FIXME: bad solution #}
					{% include 'templates/' ~ slide.layout ~ '.html' %}
				{% endfor %}
			{% endif %}
			
		</ul>
		<div class="decoration"></div>
	</div>
</div>

{% macro media(mediaData) %}
{% spaceless %}
	{% if mediaData.type == 'image' %}
		{{ supraBlock.imageHtmlTag(mediaData.id, 120, 120) | raw }}
	{% elseif mediaData.type == 'video' %}
		{% set video = mediaData %}

		{# Default width and height, resizing is done by javascript #}
		{% set width = 400 %}
		{% set ratio = 16/9 %}
		{% set height = width/ratio %}

		{% if video.resource == 'source' %}
			{# HTML #}
			<div class="block video" data-attach="$.fn.resize">
				{% if video.source_type == 'iframe' %}
					<iframe src="{{ video.src }}" width="{{ video.width }}" height="{{ video.height }}" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>
				{% elseif video.source_type == 'embed' %}
					<object width="{{ video.width }}" height="{{ video.height }}">
						<param name="movie" value="{{ video.src }} "></param>
						<param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param>
						<embed{% if supra.isCmsRequest %} wmode="opaque"{%endif%} src="{{ video.src }}" type="application/x-shockwave-flash" width="{{ video.width }}" height="{{ video.height }}" allowscriptaccess="always" allowfullscreen="true"></embed>
					</object>
				{% endif %}
			</div>

		{% elseif video.resource == 'link' and video.id %}
			{% if video.service == 'youtube' %}
				<div class="block video" data-attach="$.fn.resize">
					<object width="{{ width }}" height="{{ height|number_format }}">
						<param name="movie" value="http://www.youtube.com/v/{{ video.id }}?hl=en_US&amp;version=3&amp;rel=0"></param>
						<param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param>
						<embed{% if supra.isCmsRequest %} wmode="opaque"{%endif%} src="http://www.youtube.com/v/{{ video.id }}?hl=en_US&amp;version=3&amp;rel=0" type="application/x-shockwave-flash" width="{{ width }}" height="{{ height|number_format }}" allowscriptaccess="always" allowfullscreen="true"></embed>
					</object>
				</div>
			{% elseif video.service == 'vimeo' %}
				<div class="block video" data-attach="$.fn.resize">
					<iframe src="http://player.vimeo.com/video/{{ video.id }}?title=0&amp;byline=0&amp;portrait=0&amp;color=0" width="{{ width }}" height="{{ height|number_format }}" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>
				</div>
			{% endif %}
		{% endif %}
	{% endif %}
{% endspaceless %}
{% endmacro %}

{% macro background(backgroundData, width, height) %}
{% spaceless %}
	{% if backgroundData %}
		{% set tag = supraBlock.imageHtmlTag(backgroundData.id, width, height, true) %}
		{% set src = tag.attribute('src') %}
		{{ src }}
	{% endif%}
{% endspaceless %}
{% endmacro %}