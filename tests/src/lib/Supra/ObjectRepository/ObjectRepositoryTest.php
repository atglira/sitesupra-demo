<?php

namespace Supra\Test\ObjectRepository;

use Supra\ObjectRepository\ObjectRepository;

/**
 * Test class for ObjectRepository.
 * Generated by PHPUnit on 2011-08-16 at 10:50:12.
 */
class ObjectRepositoryTest extends \PHPUnit_Framework_TestCase
{
	/**
	 * Sets up the fixture, for example, opens a network connection.
	 * This method is called before a test is executed.
	 */
	protected function setUp()
	{
		
	}

	/**
	 * Tears down the fixture, for example, closes a network connection.
	 * This method is called after a test is executed.
	 */
	protected function tearDown()
	{
		
	}

	/**
	 */
	public function testSetDefaultObject()
	{
		// Must find the default
		$a = new ObjectRepositoryTest();
		ObjectRepository::setDefaultObject($a, 'PHPUnit_Framework_TestCase');
		$b = ObjectRepository::getObject($this, 'PHPUnit_Framework_TestCase');
		self::assertEquals($a, $b);
		
		// Default overwritten
		$c = new ObjectRepositoryTest();
		ObjectRepository::setDefaultObject($c, 'PHPUnit_Framework_TestCase');
		$b = ObjectRepository::getObject($this, 'PHPUnit_Framework_TestCase');
		self::assertEquals($c, $b);
		
		// Doesn't match by class name, skip
		$d = new ObjectRepositoryTest();
		ObjectRepository::setObject('Doctrine', $d, 'PHPUnit_Framework_TestCase');
		$b = ObjectRepository::getObject($this, 'PHPUnit_Framework_TestCase');
		self::assertEquals($c, $b);
		
		// Match by parent namespace
		$e = new ObjectRepositoryTest();
		ObjectRepository::setObject('Supra', $e, 'PHPUnit_Framework_TestCase');
		$b = ObjectRepository::getObject($this, 'PHPUnit_Framework_TestCase');
		self::assertEquals($e, $b);
		
		// Match by exact class name
		$f = new ObjectRepositoryTest();
		ObjectRepository::setObject($this, $f, 'PHPUnit_Framework_TestCase');
		$b = ObjectRepository::getObject($this, 'PHPUnit_Framework_TestCase');
		self::assertEquals($f, $b);
		
		// Better match already set, skip
		$g = new ObjectRepositoryTest();
		ObjectRepository::setObject('Supra\Test', $g, 'PHPUnit_Framework_TestCase');
		$b = ObjectRepository::getObject($this, 'PHPUnit_Framework_TestCase');
		self::assertEquals($f, $b);
		
		// Shouldn't find by master class if set by extended class
		$h = new ObjectRepositoryTest();
		ObjectRepository::setObject('Supra\Test', $h, 'Supra\Test\ObjectRepository\ObjectRepositoryTest');
		$b = ObjectRepository::getObject($this, 'PHPUnit_Framework_TestCase');
		self::assertEquals($f, $b);
	}

	/**
	 * Test object class and interface name mismatch
	 * 
	 * @expectedException         \RuntimeException
	 * @expectedExceptionMessage  instance
	 */
	public function testSetObjectInvalidInterfaceName()
	{
		$a = new ObjectRepositoryTest();
		ObjectRepository::setObject('Supra', $a, 'Supra\FileStorage\FileStorage');
	}

}
