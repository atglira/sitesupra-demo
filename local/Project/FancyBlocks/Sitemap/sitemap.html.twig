{% set heading_class = 'no-heading' %}
<div class="block sitemap">
	
	{% set heading_class = 'no-heading' %}
	{% set title_empty = supraBlock.isEmpty('block_title') %}
	{% if supra.cmsRequest or not title_empty %}
	<h2 class="block-title {% if title_empty %}hidden{% endif %}"><div>
		{{ supraBlock.property('block_title') }}
		{% if not title_empty %}
			{% set heading_class = 'has-heading' %}
		{% endif %}
	</div></h2>
	{% endif %}

	<ul class="{{ heading_class }}">
	
	{% set level = 0 %}
	{% set prevLevel = 0 %}
	
	{% for data in map %}
	
		{% set child = data.localization %}
		{% set level = data.level %}
		
		{% if level != 1 and level > prevLevel %}
			{% set diff = level-prevLevel %}
			{% for i in 1..diff %}
				<ul>
			{% endfor %}
		{% elseif level < prevLevel %}
			{% set diff = prevLevel-level %}
			</li>
			{% for i in 1..diff %}
				</ul>
				</li>
			{% endfor %}
		{% elseif level == prevLevel %}
			</li>
		{% endif %}
	
		<li>
		
		{% if level == 1 %}
			<div>
		{% endif %}
		
		<a href="/{{ supra.locale.id }}{{ child.path }}">{{ child.title }}</a>
		
		{% if level == 1 %}
			</div>
		{% endif %}
			
		{% set prevLevel = level %}
	
	{% endfor %}
			
	{# Close unclosed lists #}
	{% if prevLevel > 1 %}
	{% for i in 2..prevLevel %}
		</li>
		</ul>
	{% endfor %}
	{% endif %}
	
	</li>
	</ul>
</div>