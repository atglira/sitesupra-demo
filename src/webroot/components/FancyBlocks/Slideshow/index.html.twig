{% set width_full = 960 %}
{% set height_full = 600 %}
{% set width_small = 420 %}

{# <!-- Macro for outputing images --> #}
	{% macro imageHtmlTag (image, width, height) %}
		
		{% if not width %}{% set width = image.crop_width %}{% endif %}
		{% if not height %}{% set height = image.crop_height %}{% endif %}
		
		{# {{ supraBlock.preloadImage( image.imageId, width, height, true, image.size_name ) }} #}
		
		{% set tag = supraBlock.imageHtmlTag( image.imageId, width, height, true, image.size_name )|raw %}
		{% set width = tag.getAttribute('width') %}
		{% set height = tag.getAttribute('height') %}
		{% set ratio = width / height %}
		
		{% if width < 420 %}
			{# <!-- Larger image for table and mobile --> #}
			{% set width_mobile = 420 %}
			{% set tag_mobile = supraBlock.imageHtmlTag( image.imageId, width_mobile, width_mobile / ratio, true )|raw %}
		{% endif %}
		
		<img src="{{ tag.getAttribute('src') }}" width="{{ width }}" height="{{ height }}" {% if width < 420 %}
			 data-src-desktop="{{ tag.getAttribute('src') }}" data-height-desktop="{{ height }}"
			 data-src-mobile-all="{{ tag_mobile.getAttribute('src') }}" data-height-mobile-all="{{ tag_mobile.getAttribute('tag_mobile') }}"
			 class="responsive"
			 {% endif %}alt="" />
		
	{% endmacro %}
	{% import _self as output %}



{% set animation = supraBlock.property('animation') %}
{% set design = supraBlock.property('design') %}
{% set images = supraBlock.property('images') %}

{% if images|length or supra.cmsRequest %}

	{% for image in images %}
		{{ supraBlock.preloadImage( image.imageId, width_full, height_full true ) }}
	{% endfor %}
	
	<div class="block">
		<div class="promo-slider" data-refresh-event="promo" data-style="{{ design|default('arrows') }}" data-animation="{{ animation|default('horizontal') }}">
			<ul>
				{% for image in images %}
				<li>
					{{ outputp.imageHtmlTag (image, width_full, height_full )}}
					
					<div>
						{% set property = image.property %}

						{% if property.title %}
							{% if property.link %}
								<h2 class="mobile"><a href="{{property.link.url}}" target="{{property.link.target}}">{{property.title}}</a></h2>
								<h2 class="desktop tablet">{{ property.title }}</h2>
							{% else %}
								<h2>{{ property.title }}</h2>
							{% endif %}
						{% endif %}
						{% if property.description %}<p>{{ property.description }}</p>{% endif %}
						
						{% if property.link %}
							{% if property.link.title %}
								{% set title = property.link.title %}
							{% elseif property.link.page %}
								{% set title = property.link.page.title %}
							{% else %}
								{% set title = property.link.url %}
							{% endif %}
							<div class="more desktop tablet"><a href="{{property.link.url}}" target="{{property.link.target}}"><span><span>{{title}}</span></span></a></div>
						{% endif %}
					</div>
				</li>
				{% endfor %}
			</ul>
			
			{% if images|length %}
			<div class="shadow"></div>
			{% endif %}
		</div>
	</div>
	
	{# Instructions how to render item in CMS Gallery manager edit mode #}
	{% if supra.cmsRequest %}{% raw %}
		<script type="text/supra-template" data-supra-container-selector="ul" data-supra-id="gallerymanager-item">
			
			<li>
				{% endraw %}<img src="about:blank" alt="" width="{{ width_full }}" height="{{ height_full }}" />{% raw %}
				<div>
					<h2>{{ property.title }}</h2>
					<p>{{ property.description }}</p>
				</div>
			</li>
			
		</script>
	{% endraw %}{% endif %}
	
{% endif %}
